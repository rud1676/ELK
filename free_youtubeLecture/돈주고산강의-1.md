# 엘라스틱 서치 개요

## ELK 스택

Elasticsearch Kibana Logstash - 이 3가지를 elk스택이라 함

Beats는 다양한 버전이 있음! - network패킷, 로그, 파일 등을 쉽게 모을수 있음..

logstash는 수집이 번거로워도 자신이 원하는 데이터를 수집할 수 있어서 두개를 동시에 조화롭게 써야됨.

모든형식의 모든 소스에서 안정적이게 수집 가능!

## 역사

- 초반: 아내를 위해 요리법 검색 프로그램
- 2012년도에 검색 회사 설립!
- 로그스테시, 키바나, 등을 개발하던 사람이 독립적으로 사용하던 기능을 2.0부터 통합하여 개발 - beat제품도 개발 시작!
- BELK 5.0 출범 - 머신러닝 플러그인 X-Pack 릴리즈
- 7.2에서 SIEM 기능을 릴리즈
- 안정화 된 7.3버전

## 장점

- 무료 오픈소스
- 쉽고 빠른 설치
- 유연성 있게 커스터마이징 가능, 실시간 데이터 수집 플래폼.
- 키바나 대시보드!
- 월등한 성능!
- cluster 환경 제공- 분산 네트워크 환경
- 함께 사용 가능한 다양한 제품군 - 공식 사이트에서 확인.

## 단점..?

- 사용자를 테스터로 하는 버전. 공부가 어렵...

## 사용사례

홈페이지 참조

## 엘라스틱 서치!

- 저장과 동시에 검색이 가능하게 추구함. - 거의 실시간으로 이루어짐.
- 자바 루신의 검색엔진을 가지고 있기 때문에 가능함

## 사용사례

- 웹스토어 운영
- 로그스태시가 상주하면서 기다림 - 이벤트 발생 - 엘라스틱 서치에 올려주고 - 키바나가 바로 분석
- 사용자 입장에서 gui에서 원하는대로 알림을 받고 분석을 하게 만들수도 있음
- 많은 데이터에 대해서 시각화, 분석, 쿼리들을 하고 싶을때

## 핵심 개념

- NRT - 거의 실시간
- Cluster - 그룹 안에 노드가 있다.
- 노드
- 색인
- 타입
- 도큐맨트
- RestFul API - 웹기반의 통신
- RDB MySQL

## 엘라스틱 서치 CRUD

클러스터가 어떻게 진행되고 있는지 기본적인 확인

\_cat 있으면 기본적으로 api이다.

pretty옵션 : 엔터를 다 쳐준다.

그린 -사용가능
노란색 - 주의4
빨강 - 사용 불가능.

- 인덱싱 방식

데이터를 색인이 빠른 방식으로 저장함

- http 메서드 CRUD SQL을 비교

```
GET Read Select
PUT Update Update
POST Create Insert
DELETE Delete Delete
```

![./img/2.png](../inflearn/img/2.png)

- 질의 방법

키바나에서 devtool을 사용함!

- 데이터 입력/조회/삭제/업데이트 요약

![./img/3.png](../inflearn/img/3.png)

- 키바나에서 실습

![./img/4.png](../inflearn/img/4.png)

## 배치 프로세스

- \_bulk API를 사용하여 위의 작업을 일괄 적으로 수행할 수 있는 기능.
- 파일도 가능, 텍스트도 가능.

## 검색 API

![./img/5.png](../inflearn/img/5.png)

- 검색 결과 확인하는 법

![./img/6.png](../inflearn/img/6.png)

- 많은 요청을 하기 위한것 - 쿼리문을 json형식으로 작성 가능

![./img/7.png](../inflearn/img/7.png)

- Query DSL : 쿼리언어 - JSON 스타일 도메인 관련 언어를 제공.

![./img/8.png](../inflearn/img/8.png)

- 검색 실행하는 법 \_source만 보고싶으면 \_source를 추가하면됨

![./img/9.png](../inflearn/img/9.png)

![./img/10.png](../inflearn/img/10.png)

![./img/11.png](../inflearn/img/11.png)

![./img/12.png](../inflearn/img/12.png)

## 쿼리를 활용한 검색

![./img/13.png](../inflearn/img/13.png)

![./img/14.png](../inflearn/img/14.png)

![./img/15.png](../inflearn/img/15.png)

![./img/16.png](../inflearn/img/16.png)

## 집계 기능

![./img/17.png](../inflearn/img/17.png)

size 0으로 해서 갯수만 파악함 keyword로
신변불안
![./img/18.png](./img/18.png)
